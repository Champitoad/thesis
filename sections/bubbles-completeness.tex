We are now going to prove the \emph{completeness} of the \kl{bi-intuitionistic} (and
propositional) fragment $\kl{sysBHB}$ of \kl{system~B}, by simulating the \kl{nested
sequent} system \kl{DBiInt} of Postniece. In \sidecite{postniece_deep_2009} she
shows that this calculus is sound and complete with respect to another calculus
\intro{LBiInt}, and in Chapter 4 of her thesis \sidecite{postniece_proof_2010} she
proves that \kl{LBiInt} is sound and complete with respect to the Kripke
semantics of \kl{bi-intuitionistic} logic. Importantly, the cut rule is shown to be
\emph{\kl{admissible}} in both systems, through a syntactic process of
\kl{cut-elimination} in \kl{LBiInt}. We will rely on this result to obtain
admissibility of the cut rule \kl{i{\ua}} in $\kl{sysBHB}$, and by extension
in $\sysB$, $\kl{sysBH}$ and $\sysBB$. It might be interesting to have our own
internal \kl{cut-elimination} procedure for \kl{system~B}, notably to unveil its
computational content in the spirit of the \kl{Curry-Howard correspondence}. But this
would lead us astray from the purpose of this thesis, and thus we leave this
task for future work.

\begin{definition}[Structure]
  The \intro{structures} of \kl{DBiInt} are generated by the following grammar:
  $$X, Y \Coloneq \emptyset \mid A \mid (X,Y) \mid X \dseq Y$$ The
  structural connective `,' (comma) is associative and commutative and
  $\emptyset$ is its unit. We always consider \kl{structures} modulo these
  equivalences.
\end{definition}

\begin{definition}[Structure translation]
  The \emph{translation} $\dtrans{X}$ of a \kl{structure} $X$ as a multiset of \kl{items}
  $\Gamma$ is defined recursively as follows:
  \begin{align*}
    \dtrans{\emptyset} &= \emptyset &
    \dtrans{(X, Y)} &= \dtrans{X}, \dtrans{Y} \\
    \dtrans{A} &= A &
    \dtrans{(X \dseq Y)} &= \dtrans{X} \seq \dtrans{Y}
  \end{align*}
\end{definition}

Note that the translation $\dtrans{(-)}$ is clearly \emph{injective}: in fact
\kl{structures} are isomorphic to multisets of \kl{items} that contain only
\emph{\kl{unsaturated}} \kl{subsolutions}. Thus from now on, we will always
apply the translation implicitly, and rely on meta-variables $X, Y$ to
distinguish \kl{structures} from arbitrary \kl{solutions} when necessary.

The rules of \kl{DBiInt} are given in \reffig{rules-dbiint}. Note that like
\kl{bubble calculi}, \kl{DBiInt} is truly a \emph{\kl{deep inference}} system,
in the sense that rules can be applied on \kl{sequents} nested arbitrarily deep
inside \kl{structures}\sidenote{Our presentation of rules is slightly different
from \cite{postniece_deep_2009}: the \kl{contexts} in which rules apply are left
implicit, and thus we do not rely on their \kl{polarity}. The counterpart is
that rules always apply on \kl{sequents} and never on formulas, which makes them
more verbose. Also we do not rely on the notion of ``top-level formulas'' of a
\kl{structure}, making the \kl{propagation rules} yet more verbose.}. The main
difference lies in the fact that proofs in \kl{DBiInt} are \emph{trees} built up
by composing traditional \kl{inference rules} with multiple premisses, while we
use \kl{saturated} \kl{solutions} (\kl{neutral} bubbles) to internalize the tree
structure of proofs inside \kl{solutions}. This gives a lot of expressive power
since \kl{saturated} \kl{solutions} can themselves be nested in \kl{unsaturated}
\kl{solutions} and thus \emph{\kl{polarized}}, a phenomemon which cannot be
simulated in \kl{DBiInt}. This is why we did not prove soundness in
\refsec{bubbles-soundness} by simulating directly \kl{system~B} inside
\kl{DBiInt}, and conversely this will explain the ease with which \kl{DBiInt}
can be simulated inside \kl{system~B}.

\begin{figure*}
  \input{figures/dbiint.tex}
  \caption{Rules of the deep \kl{nested sequent} system \kl{DBiInt}}
  \labfig{rules-dbiint}
\end{figure*}

\begin{definition}[Syntactic entailment]
  We say that $\Gamma$ \emph{entails} $\Delta$ in a fragment $\mathsf{F}$ of
  rules of \kl{system~B}, written $\Gamma \intro*\prov{\mathsf{F}} \Delta$, if
  and only if $\Gamma \seq \Delta \steps{\mathsf{F}} \piq{}$. Similarly, we say
  that $X$ entails $Y$ in a fragment $\mathsf{F}$ of rules of \kl{DBiInt},
  written $X \reintro*\prov{\mathsf{F}} Y$, if and only if $X \seq Y$ has a
  proof in \kl{DBiInt} using only rules in $\mathsf{F}$.
\end{definition}

\begin{lemma}[Simulation of \kl{DBiInt}]\lablemma{simulation-dbiint}
  
  If $X \prov{\kl{DBiInt}} Y$ then $X \prov{\kl{sysBHB} \setminus
  \{\kl{i{\ua}}\}} Y$.
\end{lemma}
\begin{proof}
  By induction on the derivation of $X \prov{\kl{DBiInt}} Y$. The detailed
  proof is available in appendix (\refsec{app:bubbles-completeness}). 
\end{proof}

Assuming that the consequence relation of the Kripke semantics used by Postniece
to prove the completeness of \kl{DBiInt} coincides with the order relation of
\kl{Heyting-Brouwer algebras}, we have the following fact:

\begin{fact}[Completeness of \kl{DBiInt}]\labfact{completeness-dbiint}
  If $A \sementHB B$ then $A \prov{\kl{DBiInt}} B$.
\end{fact}

Combined with the simulation of \kl{DBiInt} from \reflemma{simulation-dbiint},
this gives us the \emph{cut-free} completeness of $\kl{sysBHB}$:

\begin{theorem}[Cut-free completeness]\labthm{bubbles-completeness}
  If $A \sementHB B$ then $A \prov{\kl{sysBHB} \setminus \{\kl{i{\ua}}\}} B$.
\end{theorem}
% \begin{proof}
%   This follows immediately from \reffact{completeness-dbiint} and
%   \reflemma{simulation-dbiint}.
% \end{proof}

In fact there are other rules of $\kl{sysBHB}$ that were not used in the simulation,
namely the \kl{$\mathbb{F}$-rule} \kl{f{\ua}}, and all \kl{$\mathbb{M}$-rules} other
than \kl{p}. Combined with the soundness of $\kl{sysBHB}$ (\refcor{soundness}), this gives us the following \emph{admissibility} theorem:

\begin{theorem}[Admissibility]\labthm{bubbles:cut-admissibility}

  If $\prov{\kl{sysBHB}} A$ then $\prov{\kl{sysBHB} \setminus
  \{\kl{i{\ua}},\kl{f{\ua}},\kl{p{-}},\kl{p{+}},\kl{a},\kl{a{-}},\kl{a{+}}\}}
  A$.
\end{theorem}

Although these rules are \kl{admissible}, they do not seem to be derivable from
other rules. We believe that they might help in making proofs more
\emph{compact} by improving \emph{factorizability}, just like the \kl(rule){cut}
rule does in standard proof formalisms.

As in \kl{sequent calculus}, every rule of \kl{system~B} other than
\kl{i{\ua}} satisfies the \emph{\kl{subformula property}}:

\begin{fact}[Subformula property]\labcor{subformula-property} If $S
  \step{\sysB \setminus \{\kl{i{\ua}}\}} T$ and $A \subsol T$, then there is a
  formula $B$ such that $A$ is a subformula of $B$ and $B \subsol S$.
\end{fact}

Thanks to \refthm{bubbles:cut-admissibility}, we thus get that
$\kl{sysBHB}$ is \emph{\kl{analytic}}. This has many nice consequences, a
well-known one being that when searching for a proof of a given \kl{solution}
$S$, one does not need to come up with or ``invent'' a formula that does not
appear in $S$. This is crucial when designing \emph{automated} decision
procedures because it reduces drastically the search space, but is also
desirable in the setting of \emph{interactive} proof building. Indeed with our
\kl{Proof-by-Action} interpretation of \kl{bubble calculi}
(\refsec{bubbles-pba}), this means that all logical reasoning can be performed
by \kl{direct manipulation} of \emph{what is already there}. Then the cut rule
\kl{i{\ua}} is indispensable, but confined to a role of \emph{theory building}:
it allows the creation of \emph{lemmas}, in order to make proofs shorter and
more tractable by humans.

As noted in \sidecite{postniece_deep_2009}, one can simply ignore rules related
to the \kl{exclusion} connective $\lsub$ to get a sound and complete system for
\kl{intuitionistic} logic. In \kl{DBiInt}, these rules are the \kl{introduction
rules} \kl{{\lsub}_R} and \kl{{\lsub}_L}, as well as the \kl{propagation rules}
\kl{{\seq}_{L1}} and \kl{{\seq}_{R2}}. Indeed, \kl{propagation rules} are only useful
in combination with \kl{introduction rules}, since \kl{{\lsub}_L} is the only
rule of \kl{DBiInt} that can introduce \kl{nested sequents} in \kl{negative}
\kl{contexts}. The situation is similar in \kl{system~B}, and in fact the proof
of \reflemma{simulation-dbiint} shows that the \kl{intuitionistic} fragment
$\kl{sysBH}$ is sufficient to simulate \kl{DBiInt} without the aforementioned
rules. The dual argument can be made for \kl{dual-intuitionistic} logic, and
thus we obtain (cut-free) \kl{intuitionistic} (resp. \kl{dual-intuitionistic})
completeness of $\kl{sysBH}$ (resp. $\sysBB$):

\begin{corollary}[Intuitionistic completeness]
  \sbr
  \begin{itemize}
    \item If $A \sementH B$ then $A \prov{\kl{sysBH} \setminus
    \{\kl{i{\ua}}\}} B$.
    \item If $A \sementB B$ then $A \prov{\sysBB \setminus
    \{\kl{i{\ua}}\}} B$.
  \end{itemize}
\end{corollary}

\begin{marginfigure}
  $$
  \R[{\limp}{-}]
  {\R[{\limp}{+}]
  {\R[{\bot}{+}]
  {\R[{\bot}{-}]
  {\R[\kl{p}]
  {\R[\kl{f{+}{\da}}]
  {\R[\kl{f{+}{+}{\da}}]
  {\R[\kl{i{\da}}]
  {\R[\kl{p}{+}]
  {\R[\kl{p}]
  {{\piq{}}}
  {{\piq{{\piq{}}}}}}
  {{\piq{\seq ({\piq{}})}}}}
  {{\piq{\seq (A \seq A)}}}}
  {{\piq{\seq (A \seq), A}}}}
  {\piq{\seq (A \seq)} A}}
  {\piq{\seq (A \seq) \sep {\piq{}}} A}}
  {\piq{\seq (A \seq) \sep \bot \seq} A}}
  {\piq{\seq (A \seq \bot) \sep \bot \seq} A}}
  {\piq{\seq \neg A \sep \bot \seq} A}}
  {\neg \neg A \seq A}
  $$
  \caption{Proof of \kl{DNE} in \kl{system~B}}
  \labfig{dne-bubbles}
\end{marginfigure}

\AP
\reffig{dne-bubbles} shows a proof of the \intro{double-negation elimination
law} (\intro{DNE}) $\neg \neg A \seq A$ in \kl{system~B}. Since $\kl{sysBH}$
is \kl{intuitionistically} complete, the well-known double-negation embedding of
\kl{classical} logic into \kl{intuitionistic} logic tells us that $\neg \neg A$
is provable in $\kl{sysBH}$ (and a fortiori in \kl{system~B}) if $A$ is a
theorem of \kl{classical} logic. Combining the two previous facts, we obtain the
\kl{classical} completeness of \kl{system~B}. In fact the proof of \kl{DNE} only
relies on the use of the \kl{f{+}{+}{\da}} rule, so we can make the following
stronger statement:

\begin{corollary}[\kl{Classical} completeness]\labcor{bubbles-completeness-classical}
  If $A$ is a theorem of \kl{classical} logic, then $\prov{\kl{sysBH} \cup
  \{\kl{f{+}{+}{\da}}\}} A$.
\end{corollary}
\begin{proof}
  By the double-negation embedding, we have $\prov{\kl{sysBH}} \neg \neg A$. Then we
  can build the following derivation:
  $$
  \R[\kl{i{\ua}}]
  {\prftree[dotted]
  {\R[\kl{p}]
  {\R[\kl{f{+}{\da}}]
  {\prftree[r][d]{\kl{DNE}}  
  {\R[\kl{p}]
  {{} \piq{}}
  {{} \piq{\piq{}}}}
  {{} \piq{\neg \neg A \seq A}}}
  {{} \piq{\neg \neg A \seq} A}}
  {{} \piq{\piq{} \sep \neg \neg A \seq} A}}
  {{} \piq{\seq \neg \neg A \sep \neg \neg A \seq} A}}
  {\seq A}
  $$
\end{proof}

Alas this argument makes use of the \kl{i{\ua}} rule. Note however that the
reason we chose to prove completeness of $\sysBHB$ by simulating a rather exotic
system like \kl{DBiInt}, was that standard \kl{sequent calculi} for
\kl{bi-intuitionistic} logic like the one of Rauszer
\sidecite{rauszer_formalization_1974} are not \emph{cut-free} complete; and in
our literature review, \kl{DBiInt} was the cut-free system closest in its syntax
and rules to \kl{system~B}. But for \kl{classical} logic we do not have this
limitation, and thus it is straightforward to simulate directly a cut-free
\kl{sequent calculus} such as \intro{G3cp} inside \kl{system~B}
\sidecite{negri_structural_2001}:

\begin{lemma}[Simulation of \kl{G3cp}]
  If $\Gamma \prov{\kl{G3cp}} \Delta$, then $\Gamma \prov{\kl{sysBH} \cup
  \{\kl{f{+}{+}{\da}}\} \setminus \{\kl{i{\ua}}\}} \Delta$.
\end{lemma}
\begin{proof}
  By induction on the \kl{G3cp} derivation. See
  \refsec{app:bubbles-completeness} for the detailed proof.
\end{proof}

\AP
Lastly, let us mention a recent result of Goré and Shillito
\cite{gore_bi-intuitionistic_2020}, where they uncover a distinction between a
\emph{weak} and a \emph{strong} consequence relation in the semantics of
\kl{bi-intuitionistic} logic. Although they define the same set of theorems,
these two relations have different properties at the meta-level, and thus the
authors argue that they define two distinct logics, called respectively
\intro{wBIL} and \intro{sBIL}. At the end of the article, they conjecture that
the various existing calculi in the literature are sound and complete for
\kl{wBIL}, including a calculus designed by Postniece. Since our completeness
proof is by simulation of the system \kl{DBiInt} also designed by Postniece, we
follow this conjecture regarding the completeness of the \kl{bi-intuitionistic}
fragment $\sysBHB$ of \kl{system~B}. For soundness, we would need to clarify the
relationship between \kl{Heyting-Brouwer algebras} and these consequence
relations, which stem instead from an analysis of the Kripke semantics of
\kl{bi-intuitionistic} logic. Since \kl{system~B} offers a very expressive
syntax, it would be interesting to investigate its ability to capture both
\kl{wBIL} and \kl{sBIL}, maybe by using distinct sets of \kl{$\mathbb{F}$-rules}.
Goré and Shillito suggest that a framework that captures both \emph{provability}
and \emph{refutability} ``in one shot'' would be needed, and we believe
\kl{system~B} might just provide this: indeed a derivation $S \steps{} \piq{}$
can be read both as a \emph{proof} of $\psint{S}$ and a \emph{refutation} of
$\nsint{S}$.