We are now going to prove the \emph{completeness} of the bi-intuitionistic (and
propositional) fragment $\sysBHB$ of system $\sysB$, by simulating the nested
sequent system \sys{DBiInt} of Postniece. In \sidecite{postniece_deep_2009} she
shows that this calculus is sound and complete with respect to another calculus
\sys{LBiInt}, and in Chapter 4 of her thesis \sidecite{postniece_proof_2010} she
proves that \sys{LBiInt} is sound and complete with respect to the Kripke
semantics of bi-intuitionistic logic. Importantly, the cut rule is shown to be
\emph{admissible} in both systems, through a syntactic process of
cut-elimination in \sys{LBiInt}. We will rely on this result to obtain
admissibility of the cut rule \rsf{i{\uparrow}} in $\sysBHB$, and by extension
in $\sysB$, $\sysBH$ and $\sysBB$. It might be interesting to have our own
internal cut-elimination procedure for system $\sysB$, notably to unveil its
computational content in the spirit of the Curry-Howard correspondence. But this
would lead us astray from the purpose of this thesis, and thus we leave this
task for future work.

\begin{definition}[Structure]
  The \emph{structures} of \sys{DBiInt} are generated by the following grammar:
  $$X, Y \Coloneq \emptyset \mid A \mid (X,Y) \mid X \dseq Y$$ The
  structural connective ``,'' (comma) is associative and commutative and
  $\emptyset$ is its unit. We always consider structures modulo these
  equivalences. To reduce parentheses, we assume that ``,'' binds tighter than
  $\dseq$. Thus, we write $X, Y \dseq Z$ to mean $(X, Y) \dseq Z$.
\end{definition}

\begin{definition}[Structure translation]
  The \emph{translation} $\dtrans{X}$ of a structure $X$ as a multiset of items
  $\Gamma$ is defined recursively as follows:
  \begin{align*}
    \dtrans{\emptyset} &= \emptyset &
    \dtrans{(X, Y)} &= \dtrans{X}, \dtrans{Y} \\
    \dtrans{A} &= A &
    \dtrans{(X \dseq Y)} &= \dtrans{X} \seq \dtrans{Y}
  \end{align*}
\end{definition}

Note that the translation $\dtrans{(-)}$ is clearly \emph{injective}: in fact
structures are isomorphic to multisets of items that contain only \emph{open}
subsolutions. Thus from now on, we will always apply the translation implicitly,
and rely on meta-variables $X, Y, Z$ to distinguish structures from arbitrary
solutions when necessary.

The rules of \sys{DBiInt} are given in \reffig{rules-dbiint}. Note that like
bubble calculi, \sys{DBiInt} is truly a \emph{deep inference} system, in the
sense that rules can be applied on sequents nested arbitrarily deep inside
structures\sidenote{Our presentation of rules is slightly different from
\cite{postniece_deep_2009}: the contexts in which rules apply are left implicit,
and thus we do not rely on their polarity. The counterpart is that rules always
apply on sequents and never on formulas, which makes them more verbose. Also we
do not rely on the notion of ``top-level formulas'' of a structure, making the
propagation rules yet again more verbose.}. The main difference lies in the fact
that proofs in \sys{DBiInt} are \emph{trees} built up by composing traditional
inference rules with multiple premisses, while we use closed solutions (neutral
bubbles) to internalize the tree structure of proofs inside solutions. This
gives a lot of expressive power since closed solutions can themselves be nested
in open solutions and thus \emph{polarized}, a phenomemon which cannot be
simulated in \sys{DBiInt}. This is why we did not prove soundness in
\refsec{bubbles-soundness} by simulating directly system $\sysB$ in
\sys{DBiInt}, and conversely this will explain the ease with which \sys{DBiInt}
can be simulated inside system $\sysB$.

\begin{figure*}
  \input{figures/dbiint.tex}
  \caption{Rules of the deep nested sequent system \sys{DBiInt}}
  \labfig{rules-dbiint}
\end{figure*}

\begin{definition}[Syntactic entailment]
  We say that $\Gamma$ \emph{entails} $\Delta$ in a fragment $\mathsf{F}$ of
  rules of system $\sysB$, written $\Gamma \prov{\mathsf{F}} \Delta$, if and
  only if $\Gamma \seq \Delta \steps_{\mathsf{F}} \piq{}$. Similarly, we say
  that $X$ entails $Y$ in a fragment $\mathsf{F}$ of rules of \sys{DBiInt},
  written $X \prov{\mathsf{F}} Y$, if and only if $X \seq Y$ has a proof in
  \sys{DBiInt} using only rules in $\mathsf{F}$.
\end{definition}

\begin{lemma}[Simulation of \sys{DBiInt}]\lablemma{simulation-dbiint} If $X
  \prov{\msys{DBiInt}} Y$ then $X \prov{\sysBHB \setminus
  \{\rsf{i{\uparrow}}\}} Y$.
\end{lemma}
\begin{proof}
  By induction on the derivation of $X \prov{\msys{DBiInt}} Y$.
\end{proof}

\begin{fact}[Completeness of \sys{DBiInt}]\labfact{completeness-dbiint}
  If $A \sementHB B$ then $A \prov{\msys{DBiInt}} B$.
\end{fact}

\begin{theorem}[Cut-free completeness]\labthm{bubbles-completeness}
  If $A \sementHB B$ then $A \prov{\sysBHB \setminus \{\rsf{i{\uparrow}}\}} B$.
\end{theorem}
\begin{proof}
  This follows immediately from \reffact{completeness-dbiint} and
  \reflemma{simulation-dbiint}.
\end{proof}

\begin{corollary}[Cut admissibility]\label{cor:cut-admissibility}

  If $\prov{\sysBHB} A$ then $\prov{\sysBHB \setminus \{\rsf{i{\uparrow}}\}} A$.
\end{corollary}
\begin{proof}
  This follows immediately from \refthm{bubbles-soundness} and
  \refthm{bubbles-completeness}.
\end{proof}

As in sequent calculus, every rule of system $\sysB$ other than
\rsf{i{\uparrow}} satisfies the \emph{subformula property}:

\begin{fact}[Subformula property]\label{cor:subformula-property}
  If $S \step_{\sysB \setminus \{\rsf{i{\uparrow}}\}} T$ and $A \subsol T$ then
  $A \subsol S$.
\end{fact}

Thanks to cut admissibility, we thus get that system \sys{B} is \emph{analytic}.
This has many nice consequences, a well-known one being that when searching for
a proof of a given solution $S$, one does not need to come up with or ``invent''
a formula that does not appear in $S$. This is crucial when designing
\emph{automated} decision procedures because it reduces drastically the search
space, but is also desirable in the setting of \emph{interactive} proof
building. Indeed with our Proof-by-Action interpretation of bubble calculi
(\refsec{bubbles-pba}), this means that all logical reasoning can be performed
by direct manipulation of \emph{what is already there}. Then the cut rule is
indispensable, but confined to a role of \emph{theory building}: it allows the
creation of \emph{lemmas}, in order to make proofs shorter and more tractable by
humans.

As noted in \cite{postniece_deep_2009}, one can simply ignore rules related to
the exclusion connective $\lsub$ to get a sound and complete system for
intuitionistic logic. In \sys{DBiInt}, these rules are the introduction rules
\rsf{{\lsub}_R} and \rsf{{\lsub}_L}, as well as the propagation rules
\rsf{{\seq}_{L1}} and \rsf{{\seq}_{R2}}. Indeed the latter are only useful in
combination with the former, since \rsf{{\lsub}_R} and \rsf{{\lsub}_L} are the
only rules of \sys{DBiInt} that can introduce nested sequents in negative
contexts. The situation is similar in system $\sysB$, and in fact the proof of
\reflemma{simulation-dbiint} shows that the intuitionistic fragment $\sysBH$ is
sufficient to simulate \sys{DBiInt} without the aforementioned rules. The dual
argument can be made for dual-intuitionistic logic, and thus we obtain
(cut-free) intuitionistic (resp. dual-intuitionistic) completeness of $\sysBH$
(resp. $\sysBB$):

\begin{corollary}[Intuitionistic completeness]
  ~\\\vspace{-1em}
  \begin{itemize}
    \item If $A \sementH B$ then $A \prov{\sysBH \setminus
    \{\rsf{i{\uparrow}}\}} B$.
    \item If $A \sementB B$ then $A \prov{\sysBB \setminus
    \{\rsf{i{\uparrow}}\}} B$.
  \end{itemize}
\end{corollary}

% Note that $\{\rsf{f{+}{-}{\downarrow}}, \rsf{f{-}{-}{\uparrow}},
% \rsf{{\lsub}{-}}, \rsf{{\lsub}{+}}\}$ are the only rules of $\sysBHB$ that
% involve negative solutions and/or exclusions.

\begin{marginfigure}
  $$
  \R[{\limp}{-}]
  {\R[{\limp}{+}]
  {\R[{\bot}{+}]
  {\R[{\bot}{-}]
  {\R[\rsf{p}]
  {\R[\rsf{f{+}{\downarrow}}]
  {\R[\rsf{f{+}{+}{\downarrow}}]
  {\R[\rsf{i{\downarrow}}]
  {\R[\rsf{p}{+}]
  {\R[\rsf{p}]
  {{} \piq{}}
  {{} \piq{\piq{}}}}
  {{} \piq{\seq (\piq{})}}}
  {{} \piq{\seq (A \seq A)}}}
  {{} \piq{\seq (A \seq), A}}}
  {{} \piq{\seq (A \seq)} A}}
  {{} \piq{\seq (A \seq) \sep \piq{}} A}}
  {{} \piq{\seq (A \seq) \sep \bot \seq} A}}
  {{} \piq{\seq (A \seq \bot) \sep \bot \seq} A}}
  {{} \piq{\seq \neg A \sep \bot \seq} A}}
  {\neg \neg A \seq A}
  $$
  \caption{Proof of DNE in system $\sysB$}
  \labfig{dne-bubbles}
\end{marginfigure}

\reffig{dne-bubbles} shows a proof of the double-negation elimination law
$\mathrm{DNE} \defeq \neg \neg A \seq A$ in system $\sysB$. Since $\sysBH$ is
intuitionistically complete, the well-known double-negation embedding of
classical logic into intuitionistic logic tells us that $\neg \neg A$ is
provable in $\sysBH$ (and a fortiori in $\sysB$) if $A$ is a theorem of
classical logic. Combining the two previous facts, we obtain the classical
completeness of system $\sysB$. In fact the proof of DNE only relies on the use
of the \rsf{f{+}{+}{\downarrow}} rule, so we can make the following stronger
statement:

\begin{corollary}[Classical completeness]\label{cor:bubbles-completeness-classical}
  If $A$ is a theorem of classical logic, then $\prov{\sysBH \cup
  \{\rsf{f{+}{+}{\downarrow}}\}} A$.
\end{corollary}
\begin{proof}
  By the double-negation embedding, we have $\prov{\sysBH} \neg \neg A$. Then we
  can build the following derivation:
  $$
  \R[\rsf{i{\uparrow}}]
  {\prftree[d]
  {\R[\rsf{p}]
  {\R[\rsf{f{+}{\downarrow}}]
  {\prftree[r][d]{DNE}  
  {\R[\rsf{p}]
  {{} \piq{}}
  {{} \piq{\piq{}}}}
  {{} \piq{\neg \neg A \seq A}}}
  {{} \piq{\neg \neg A \seq} A}}
  {{} \piq{\piq{} \sep \neg \neg A \seq} A}}
  {{} \piq{\seq \neg \neg A \sep \neg \neg A \seq} A}}
  {\seq A}
  $$
\end{proof}

Alas this argument makes use of the \rsf{i{\uparrow}} rule. Note however that
the reason we chose to prove completeness of $\sysBHB$ by simulating a rather
exotic system like \sys{DBiInt}, was that standard sequent calculi for
bi-intuitionistic logic like the one of Rauszer
\sidecite{rauszer_formalization_1974} are not \emph{cut-free} complete; and in
our literature review, \sys{DBiInt} was the cut-free system closest in its
syntax and rules to system $\sysB$. But for classical logic we do not have this
limitation, and thus it should be straightforward to simulate directly a
cut-free sequent calculus such as \sys{LK}.\todo{Do the proof in appendix,
should be quick}