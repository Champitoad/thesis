\setchapterpreamble[u]{\margintoc}
\chapter{Asymmetric Bubble Calculus}
\labch{bubbles}

We introduce a new kind of nested sequent proof system dubbed \emph{bubble
calculus}. Inspired by the \emph{membrane} mechanism of the chemical abstract
machine ({\cham} hereafter) \sidecite[25em]{berry_chemical_1989}, so-called
\emph{bubbles} internalize the notion of \emph{subgoal} inside sequents, rather
than through the tree structure induced by inference rules. This allows for a
more hierarchical representation of the proof state, where contexts can be
shared between different subgoals. In addition to the usual textual syntax, the
bubble calculus can be expressed in a graphical syntax, where logical meaning is
captured by \emph{physical} constraints on diagrammatic manipulations, instead
of \emph{virtual} restrictions on available inference rules.

% We introduce a new kind of nested sequent proof systems dubbed \emph{bubble
% calculi}. Inspired by the \emph{membrane} mechanism of the chemical abstract
% machine ({\cham} hereafter) \sidecite[25em]{berry_chemical_1989}, so-called
% \emph{bubbles} internalize the notion of \emph{subgoal} inside sequents, rather
% than through the tree structure induced by inference rules. This allows for a
% more hierarchical representation of the proof state, where contexts can be
% shared between different subgoals. In addition to the usual textual syntax,
% bubble calculi can be expressed in a graphical syntax, where logical meaning is
% captured by \emph{physical} constraints on diagrammatic manipulations, instead
% of \emph{virtual} restrictions on available inference rules. In the chemical
% metaphor, \emph{intuitionism} is then characterized as the phenomenon of
% \emph{repulsion} between objects that have the same polarity.

This chapter and the next are organized mostly chronologically, following the
evolution of our idea of a bubble calculus through the addition of new features.
\todo{Put this sentence in the introduction.}

We start in \refsec{chemical} with the genesis of the idea of bubble calculus,
coming from the observation that our Proof-by-Action paradigm (\refch{pba})
lends itself quite naturally to a metaphorical interpretation, where actions are
seen as \emph{chemical} reactions. In \refsec{bubbles} we introduce the concept
of \emph{bubble} as a way to control the scope of hypotheses inside nested
sequents that we call \emph{solutions}. In \refsec{asymmetric} we describe our
proof system for intuitionistic logic dubbed \emph{asymmetric bubble calculus},
based on multiset rewriting rules on solutions comprising at most one
conclusion. Finally in \refsec{bubbles-pba} we import back ideas from this
bubble calculus to the realm of GUIs for interactive proof building, analysing
their possible impact for UX improvements.


\section{The chemical metaphor}\labsec{chemical}

The Proof-by-Action paradigm introduced in \refch{pba} offers multiple ways to
the user to attack the proof of a theorem: DnD actions for subformula linking
and equality rewriting are the main mechanism, but they only work in a goal
comprising multiple items. Since it is customary in proof assistants to specify
the goal to be proved as a single logical formula, one needs a way to decompose
it into many items for further processing through DnD. This is precisely what
the introduction rules for logical connectives in sequent calculus do, and
following the Proof-by-Pointing paradigm \cite{PbP} we map them to click
actions (see \refsec{clicks}).

So visually, a proof in Actema consists in breaking logical items into subitems
positioned freely in space, and then bringing those subitems together to make
them interact and produce a new item. This is quite evocative of a
\emph{chemical reaction} controlled by the user, where logical formulas are akin
to molecules made of propositional atoms linked together by logical
connectives\sidenote{This precise metaphor about the molecular structure of
propositions can already be found in Russell's introduction to Wittgenstein's
Tractatus Logico-Philosophicus, which was the main inspiration to his philosophy
of \emph{logical atomism} \cite{tractatus-chemical}\cite{klement_russells_2020}.
Even earlier in the history of logic, C. S. Peirce took inspiration from
chemical diagrams to devise his \emph{existential graphs} (that we introduce in
\refch{eg}) \cite{Roberts1973-chemical}.}. Click actions are then a mean to
``heat'' molecules to the point of breaking these chemical bonds. The most
canonical examples are the right-introduction rule for implication $\limp$ and
the left-introduction rule for conjunction $\land$, which break respectively a
conclusion/red item/positive ion into a hypothesis/blue item/negative ion and a
new conclusion, and a hypothesis into two hypotheses. In fact, it is strongly
conjectured that these are the only click actions needed to obtain a complete
deductive system for propositional logic: breaking red implications allows for
backward DnDs, and blue conjunctions for forward DnDs\sidenote{In predicate
logic, one would also need the right (resp. left) introduction rule for
$\forall$ (resp. $\exists$). It might also be the case that backward DnDs alone
are sufficient for completeness, since a linkage of the form $A \back \select{B}
\limp C$ will involve a forward phase. In this case only the right introduction
rules for $\limp$ and $\forall$ would be required.}.
% \sidenote{Interestingly,
% those rules are the basis for the adjunction between $\land$ and $\limp$ in the
% interpretation of IPL into cartesian closed categories.}

Rather than completeness, the issue here is \emph{consistency} of the user
interface: if the user is allowed to decompose red $\limp$ and blue $\land$, she
will assume naturally that she can also decompose blue $\limp$ and red $\land$,
as well as $\lor$ of any color. While red $\lor$ can be handled by pointing
directly at the disjunct to be proved, other configurations correspond to rules
of sequent calculus with multiple premisses. In Actema, this corresponds to
creating a new subgoal for each premise, where subgoals are displayed one at a
time in different \emph{tabs}: this new interface mechanism breaks the chemical
metaphor. The root cause lies in the way sequent calculus implements
\emph{context-scoping}: each subgoal will share the same initial context of
hypotheses, but future hypotheses ``buried'' in the conclusions must be
available only in their respective subgoals. The tabs mechanism implements this
by forcing the user to focus on exactly one tab/subgoal, thus making it
impossible to display items from different subgoals on the same screen, which
renders interaction between them physically impossible.


\section{Bubbles and solutions}\labsec{bubbles}

In order to accomodate context-scoping within the chemical metaphor, we were led
to explore a notion of \emph{bubble} inspired by the \emph{membranes} of the
{\cham} \cite{berry_chemical_1989}. The latter are used to delineate zones of
\emph{local} interaction, which are still porous to external data. This is
precisely what we want to do here: let us consider that the user tries to prove
the sequent $\Gamma \seq A \land B$. By clicking on the red item $A \land B$,
she will break it into two bubbles $\bubbleT{\seq A}$ and $\bubbleT{\seq B}$.
Then she might decompose $A$ and $B$ further into sequents $\sigma_A = \Gamma_A
\seq C_A$ and $\sigma_B = \Gamma_B \seq C_B$, and use hypotheses from $\Gamma$
by dragging them inside either $\bubbleT{\sigma_A}$ or $\bubbleT{\sigma_B}$.
However, hypotheses from $\Gamma_A$ and $\Gamma_B$ cannot be dragged out from
their respective bubble, since then they could be used in the other bubble and
violate context-scoping.

This situation is illustrated in \reffig{bubbles-flow}, where bubbles are
represented by gray circles, and possible drag moves of formulas by arrows. More
specifically, green and orange arrows symbolize respectively valid and invalid
moves. Notice how this graphical depiction of bubbles exhibits their
\emph{topological} behavior: while objects can enter inside bubbles from the
outside, they get blocked by the membrane in the opposite direction. Indeed the
only relevant feature of the circle representation is that it divides the space
into an \emph{interior} and an \emph{exterior}. Then the \emph{nesting} of
circles and the \emph{positions} of formulas relative to them encode
respectively the \emph{tree} structure of the proof, and the scope of hypotheses
in it.

\begin{figure}
  \scalebox{1.5}{\tikzfig{bubbles-flow}}
  \caption{Context-scoping in bubbles as topological constraints}
  \labfig{bubbles-flow}
\end{figure}

Bubbles can also be seen as a way to internalize in the syntax of sequents the
notion of \emph{subgoal}, which requires in turn to allow nesting of sequents
inside each other. The proof state is not a set of subgoals anymore, but a
single nested sequent of this sort, that we call a \emph{solution}\sidenote{The
term ``solution'' refers here to the metaphor of a \emph{chemical solution} made
up of an unordered collection of molecules. Which is quite ironic, since we use
it to denote goals waiting to be proved, that is problems lacking a
solution\dots}. In textual syntax, solutions $S$ are generated by the
following grammar:
\begin{mathpar}
  S, T, U \Coloneq \Gamma \piq{S_1 \sep \ldots \sep S_n} \Delta
  \and
  \Gamma, \Delta \Coloneq A_1, \ldots, A_n
\end{mathpar}
where the $A_i$ are usual formulas of FOL. Thus solutions are just like
sequents, except that we add a collection of nested solutions $S_i$ that will
represent subgoals, or premisses of usual inference rules. To be more precise,
the collections of formulas $A_i$ and solutions $S_i$ are \emph{multisets},
which gives the following mutually recursive definitions:
\begin{definition}[Ion]
  An \emph{ion} is a formula charged either \emph{negatively} (hypothesis) or
  \emph{positively} (conclusion).
\end{definition}
\begin{definition}[Bubble]
  A \emph{bubble} is a solution enclosed in a membrane.
\end{definition}
\begin{definition}[Solution]\labdef{solution}
  A \emph{solution} $S$ is a multiset of ions and bubbles. It is
  \emph{single-conclusion} if it contains at most one positive ion. We will use
  letters $\mathcal{S}, \mathcal{T}, \mathcal{U}$ to denote multisets of
  solutions.
\end{definition}
Note that in the above definitions, bubbles play a purely metaphorical role and
could be dispensed with. But it will be useful later on to distinguish them
conceptually from solutions.

\section{Asymmetric calculus}\labsec{asymmetric}

\subsection{Interpreting solutions}

A natural way to give logical meaning to a solution is to translate it into a
formula. In the following we provide one such translation, which will play a
determining role in the design of inference rules for manipulating solutions. We
qualify it of \emph{asymmetric} because it only works for single-conclusion
solutions, in the same way that \sys{LJ} only works for single-conclusion
sequents.

\begin{remark}
In this section we only deal with single-conclusion solutions, but the more
general case will be studied starting from \refsec{branching}.
\end{remark}

Just like a sequent, a solution is semantically equivalent to an implication,
except that we add the \emph{conjunction} of all subgoals to the consequent:

\begin{definition}[Asymmetric interpretation]\labdef{ainterp}
  The \emph{asymmetric interpretation} of a solution is defined recursively by:
  $$\ainterp{\Gamma \piq{S_1 \sep \ldots \sep S_n} \Delta} = \bigwedge \Gamma
    \limp \bigwedge \Delta \land \bigwedge_i{\ainterp{S_i}}$$
\end{definition}

Note that we join formulas in $\Delta$ conjunctively: since we do not consider
solutions with more than one conclusion, this is just to handle the case where
$\Delta = \emptyset$, and thus $\bigwedge \Delta = \top$. This subtle detail is
in fact essential to the way we encode the tree structure of proofs inside
solutions:
\begin{itemize}
  \item a solution with one conclusion corresponds to a \emph{leaf} of the proof
  tree, i.e. a subgoal;
  \item a solution with no conclusion corresponds to a \emph{node} of the proof
  tree, i.e. a branching point where we created multiple subgoals.
\end{itemize}
This will soon become clearer with examples of derivations in our calculus. In
\refsec{branching}, we will consider a different interpretation of solutions that
entails a different encoding of the proof structure in them.

\subsection{Sequent-style rules}

\begin{figure*}
  \input{figures/sequent-BJ.tex}
  \caption{Sequent-style presentation of the asymmetric bubble calculus \sys{BJ}}
  \labfig{sequent-BJ}
\end{figure*}

Our initial idea for a proof system based on solutions was quite simple: we take
the inference rules of \sys{LJ}, and turn them all into unary rules by encoding
premisses as bubbles. This gives the basis for the set of rules presented in
\reffig{sequent-BJ}, that defines our asymmetric bubble
calculus for intuitionistic logic dubbed \sys{BJ}. It is divided in five groups:
\begin{itemize}
  \item The {\identity}, {\resource} and {\heating} groups correspond
  respectively to the identity, structural and logical rules of sequent
  calculus, following the terminology of \sidecite{girard:hal-01322183}. More
  precisely, rules {\rnmsf{i{\downarrow}}} and {\rnmsf{i{\uparrow}}} correspond
  to the axiom and cut rules; rules {\rnmsf{w}} and {\rnmsf{c}} to the weakening
  and contraction rules; and every rule of the form $\mcirc{-}$ (resp.) that
  is, the axiom and cut rules, the contraction and weakening rules, and
  introduction rules for logical connectives.
  \item The {\flow} and {\popping} groups are new, and define the behavior of
  bubbles. More specifically, $\mathbb{F}$-rules characterize how information
  flows in solutions by specifying what kinds of objects can traverse bubbles,
  and in which direction. They play the same role as \emph{switch} rules in
  formalisms based on CoS \cite{Guglielmi1999ACO}, which includes our own
  subformula linking rules (\reffig{DISL}). In the asymmetric bubble calculus
  there is only one $\mathbb{F}$-rule {\rnmsf{f{-}}} allowing hypotheses to flow
  inside bubbles.
  
  As their name suggests, $\mathbb{P}$-rules allow to \emph{pop} empty bubbles,
  which can be interpreted as the action of dismissing solved subgoals. In CoS
  they would correspond to congruence rules handling the truth unit $\top$, and
  in subformula linking to the unit rules (\reffig{DISL-U}). In the asymmetric
  bubble calculus there is only one $\mathbb{P}$-rule {\rnmsf{p}} allowing to
  pop any empty bubble.
\end{itemize}

Now that we have rules for manipulating solutions, and since solutions can be
nested through bubbles, we need a notion of \emph{context} for applying rules on
subsolutions of arbitrary depth:

\begin{definition}[Solution context]\labdef{solution-context}
  % \emph{Solution contexts} are defined by the following grammar:
  % $$S\hole \Coloneq \hole \mid \Gamma \piq{\mathcal{S} \sep S\hole \sep
  % \mathcal{T}} \Delta$$
  A \emph{solution context} $S\hole$ is a solution which contains exactly one
  occurrence of the special solution $\hole$ called the \emph{hole}. Given
  another solution $T$, we write $S\select{T}$ to denote the solution equal to
  $S\hole$ where $\hole$ has been replaced by $T$.
\end{definition}

Then every rule of \reffig{sequent-BJ} is applicable in any
context $U\hole$. That is:
$$\vcenter{\R{S}{T}} \quad \text{should be read as} \quad
\vcenter{\R{U\select{S}}{U\select{T}}} \quad \text{for all $U\hole$}$$

\begin{definition}[\sys{BJ}-derivation]\labdef{BJ-deriv} A \emph{derivation}
$\deriv{\mathcal{D}}{S}{T}$ in \sys{BJ} is a list $\mathcal{D}$ of (instances
of) inference rules with premiss $T$ and conclusion $S$\sidenote[][-15cm]{The
direction of the arrow is from conclusion to premiss, to stay consistent with
our interactive proof building setting where inference rules are seen as
goal-modifying actions.}.
\end{definition}

\begin{definition}[\sys{BJ}-proof]\labdef{BJ-proof}
A \emph{proof} of a solution $S$ in \sys{BJ} is a derivation
$\deriv{\mathcal{D}}{S}{\piq{}}$ that reduces $S$ to the empty solution, which
denotes the proof state where there are no subgoals left.
\end{definition}

\begin{marginfigure}
  \input{figures/ex-seq-BJ.tex}
  \caption{Example of sequent-style proof in \sys{BJ}}
  \labfig{ex-seq-BJ}
\end{marginfigure}

\subsection{Proof-as-trace}

An example of proof in \sys{BJ} is shown in \reffig{ex-seq-BJ}, where the
focused subsolution is squared for each inference. Notice that many rules could
have been applied in a different order: for instance all applications of the
{\rnmsf{p}} rule could have been postponed to the top/end of the derivation.
This is generally true of all formalisms based on CoS, which is known in the
deep inference literature for its ``bureaucracy''. In \sys{BJ},
$\mathbb{H}$-rules aggravate the matter by adding all inessential rule
permutations from sequent calculus to those of CoS. As our wording suggests,
this is usually perceived negatively in deep inference proof theory, where a
central question is that of finding \emph{canonical} representations of proof
objects \sidecite{strasburger-problem-2019}.

However in our interactive proof-building setting, it should rather be seen as a
\emph{desirable} property of the system. Indeed, one consequence is that the
user has more freedom to organize her reasoning in whichever order she wants, in
an incremental and guided way. One should remember that in the Proof-by-Action
paradigm, the focus is not the proof object, which is implicit and hidden to the
user, but the \emph{process} of building it. Then a \sys{BJ}-derivation is
better understood as the \emph{trace} of this building process, rather than the
constructed proof\sidenote{The idea of \emph{proof-as-trace} is relatively
common in logic programming \cite{miller_survey_2022}, but not so much in deep
inference proof theory. It is Jean-Baptise Joinet who --- through private
communication --- shared with us his idea of applying it in this setting, based
on his own work interpreting CoS for \sys{MLL} as a system for building
\emph{multiplicative proof nets} \cite{joinet_completeness_2007}.}. And the fact
that this trace corresponds, or can be reduced to a more canonical
representation is of no concern to the user. What matters for a good
proof-building interface is to be as flexible as possible, in order to match the
user's own mental process of argumentation.

Of course flexibility comes at a price, and the rules of \sys{BJ} are probably
too numerous and low-level to provide a good basis for a user interface. Some of
these concerns will be tackled in \refch{bubbles-symm}, but we think a better
answer might have been found with the proof system introduced in
\refch{flowers}, and its associated prototype of GUI presented in
\refch{flowerprover}.

\todo{ This section might be getting too long with too many subsections; will
  probably need to move philosophical reflections like this somewhere else.
  Maybe a conclusion to this chapter? But the ideas seem to apply to all systems
  in this thesis, and thus may deserve a more general rewording in
  \refch{intro}. }

\subsection{Graphical rules}

\begin{figure*}
  \input{figures/graphical-BJ}
  \caption{Graphical presentation of the asymmetric bubble calculus \sys{BJ}}
  \labfig{graphical-BJ}
\end{figure*}

While the sequent-style presentation of \sys{BJ} clearly shows its filiation
with sequent calculus, its syntax is quite heavy, and obscures an important
property of the rules: they almost always preserve the contexts $\Gamma, \Delta$
of formulas and $\mathcal{S}$ of bubbles. That is, the rules of \sys{BJ} are
\emph{local}. This enables a more economical and graphical presentation of the
rules in \reffig{graphical-BJ}, where \sys{BJ} is seen as a multiset rewriting
system just like the {\cham} thanks to \refdef{solution}. Instead of relying on
a notion of solution context, we define formally what it means to be a
subsolution:

\begin{definition}[Subsolution]\labdef{subsolution}
  $S$ is a \emph{subsolution} of $T$, written $S \subsol T$, if either $S
  \subseteq T$ or $S \subsol T_0$ for some $T_0 \in T$, where $\subseteq$
  denotes multiset inclusion. 
\end{definition}

Then a multiset rewriting rule $\rrule{\mathsf{r}}{S}{T}$ can be applied in a
solution $U$ whenever $S \subsol U$, by replacing one occurrence of $S$ by $T$
inside $U$. The notions of derivation (\refdef{BJ-deriv}) and proof
(\refdef{BJ-proof}) stay unchanged, by observing that the rewriting rule
$\rrule{\mathsf{r}}{S}{T}$ from $S$ to $T$ and the inference rule
$\irule{\mathsf{r}}{S}{T}$ with premiss $T$ and conclusion $S$ denote the same
rule $\mathsf{r}$.

\todo{Add definition of multiset inclusion somewhere?}

\todo{Maybe split both \reffig{ex-gra-BJ} and \reffig{ex-seq-BJ} in two figures,
one for the beginning of the proof upto {\rnmsf{f{-}}}, and a generic one for
the two subproofs starting with {\rnmsf{{\limp}{-}}}.}

\reffig{ex-gra-BJ} shows the graphical presentation of the same \sys{BJ}-proof
as in \reffig{ex-seq-BJ}. Whereas in \reffig{ex-seq-BJ} we squared the whole
subsolutions corresponding to the conclusions of inference rules, here we
squared on each line the redex modified by the associated rewriting rule. This
example highlights the greater locality of the rewriting approach, by indicating
more precisely which parts of the proof state are changed by the rules. But it
still over-approximates the modifications that really need to be performed to
carry the transformations. Indeed, by only exposing the data of a redex $S$ and
a reddendum $T$, a rewriting rule $\rrule{\mathsf{r}}{S}{T}$ can only be
interpreted as the deletion of $S$ followed by the insertion $T$. Taking for
instance the {\rnmsf{{\limp}{-}}} rule in \reffig{graphical-BJ}, one can
describe its graphical behavior more finely as resulting from the following
sequence of \emph{edits}:
\begin{enumerate}
  \item Erase the $\hypo{{\limp}}$ connective;
  \item Change the polarity of $\hypo{A}$ from hypothesis to conclusion;
  \item Insert a new empty bubble;
  \item Move $\conc{A}$ in this bubble;
  \item Insert a new empty bubble;
  \item Move $\hypo{B}$ in this bubble;
  \item If $\conc{\Delta}$ is not empty, also move $\conc{\Delta}$ in this bubble.
\end{enumerate}
It would be interesting to consider the question of finding a minimal set of
edit operations like these, that can simulate all the rules of
\sys{BJ}\sidenote{As will become apparent in \refsec{bubbles-completeness},
\sys{BJ} itself provides a finer-grained simulation of the rules of sequent
calculus, which in turn is known to be a more detailed variant of \emph{natural
deduction}. Interestingly through the Curry-Howard isomorphism, this would
correspond to a \emph{chain of compilation}, starting from the higher-level
$\lambda$-calculus (natural deduction), going into abstract machines (sequent
calculus) \cite{downen_sequent_2016}, down to something akin to \emph{assembly
language} with \texttt{jump} instructions (Section 6.3.1 of
\cite{guenot_nested_2013}).}. Note however that most of the above edits are
\emph{unsound} as reasoning steps. If not for logical insight, such an edit
calculus could still be relevant \emph{computationally}, typically by enabling
efficient implementations of the rules with a small memory footprint.

\begin{figure*}
  \input{figures/ex-gra-BJ.tex}
  \caption{Example of graphical proof in \sys{BJ}}
  \labfig{ex-gra-BJ}
\end{figure*}

\section{Back to Proof-by-Action}\labsec{bubbles-pba}

When looking at the \sys{BJ}-proof of \reffig{ex-gra-BJ}, the astute reader
might have been reminded of the Proof-by-Action paradigm as introduced in
\refch{pba}, by seeing redexes as the items involved in a graphical action ---
there are always at most two. More precisely, $\mathbb{H}$-rules correspond to
\emph{click} actions on blue ({\rnm{\mcirc{-}}} rules) or red items
({\rnm{\mcirc{+}}} rules), and the {\rnmsf{i{\downarrow}}} rule corresponds to
the most basic DnD action between dual occurrences of a formula.

As mentioned earlier when comparing \sys{BJ} to \sys{LJ}, the novelty here lies
with $\mathbb{H}$-rules, $\mathbb{F}$-rules and $\mathbb{P}$-rules that deal
with \emph{bubbles}. Remember that the goal behind the idea of bubble calculus
was precisely to provide a new way to manipulate subgoals through bubbles
instead of tabs, which are more in line with the chemical metaphor. It is quite
easy to imagine a GUI presenting the proof state as a solution, in a graphical
layout close to that of \reffig{ex-gra-BJ}\sidenote{Although there might be some
challenges in implementing an efficient layouting algorithm for bubbles,
typically to make solutions fit into the screen.}. Like formulas in blue and red
items, whole subgoals could now be shown on the same screen in their respective
bubbles, and be freely moved around with a pointing device. Following are some
ideas for mapping the remaining rules of \sys{BJ} in such a GUI:

\begin{marginfigure}
  $$
  \begin{array}{rcll}
    \hypo{A}~~~\hypo{B} &\step &\hypo{A \forw B} &\forw \\
    \hypo{A}~~~\conc{B} &\step &\conc{A \back B} &\back \\
  \end{array}
  $$
  \caption{Linkage creation rules in \sys{BJ}}
  \labfig{bubbles-linkage}
\end{marginfigure}

% \begin{marginfigure}
%   $$
%   \begin{array}{rcll}
%     \conc{t = t} &\step &&{=}{+} \\
%     \hypo{t = u}~~~A &\step &\subst{A}{u}{t} &{=}{-}1 \\
%     \hypo{t = u}~~~A &\step &\subst{A}{t}{u} &{=}{-}2 \\
%   \end{array}
%   $$
%   \caption{Rules for equality in \sys{BJ}}
%   \labfig{bubbles-eq}
% \end{marginfigure}

% \begin{marginfigure}
%   \input{figures/bubbles-vars.tex}
%   \caption{Rules for variables and definitions in \sys{BJ}}
%   \labfig{bubbles-vars}
% \end{marginfigure}

\begin{description}
  \item[\textbf{\flow}]
    The {\rnmsf{f{-}}} rule plays a special role, in that it would not be mapped
    to any particular action. Indeed it captures the way information flows in
    solutions, and we already described in \refsec{bubbles} how this is
    reflected in the topological behavior of bubbles. Thus it could be
    implemented in the graphical interface as a kind of \emph{physics engine}:
    when dragging an item around the proof canvas, it would get stuck on the
    membrane of bubbles, except if it is blue and the drag movement goes inward.
    This of course would provide a level of interactivity unseen before in a
    proving interface, making it very discoverable and playful. It also combines
    nicely with DnD actions in general: for instance a sequence of applications
    of {\rnmsf{f{-}}} followed by {\rnmsf{i{\downarrow}}} could be performed as
    a single DnD action, where the dragged hypothesis crosses successively the
    various bubbles in its way.
  \item[\textbf{\popping}]
    The {\rnmsf{p}} rule can be mapped very straightforwardly to the action of
    clicking on the area of an empty bubble, in order to pop it. It could also
    be entirely automated, by letting the proof engine eagerly pop empty bubbles
    as soon as they appear in a solution.
  \item[\textbf{\resource}]
    % In Actema, hypotheses are displayed in blue items inside a reserved zone
    % holding the entire context, including also local variables and definitions
    % in green items. The resource behavior of blue items placed by the user in
    % the proof canvas differs from those in the context zone: while the former
    % are consumed after a backward or forward DnD, the latter are preserved and
    % thus implicitly duplicated\sidenote{In the literature on focusing in linear
    % logic, this corresponds roughly to the distinction between the \emph{storage
    % zone} in sequents where formulas can be duplicated and discarded at will,
    % and the \emph{linear zone} where they cannot.}. In a bubble-based GUI, one
    % could keep this behavior, where the context is filled with all items 
    The contraction rule {\rnmsf{c}} could be mapped to a specific triggering
    input when starting to drag a blue item $\hypo{A}$ (e.g. a shortkey if a
    keyboard is available, or a long press on the item on a touchscreen), which
    has the effect of keeping a copy of $A$ at its original location in addition
    to moving the item\sidenote{This mechanism is quite standard in GUIs that
    manipulate duplicable resources like file managers, where one maintains the
    \texttt{CTRL} key to enable copy mode. It was also chosen by K. Chaudhuri to
    implement contraction in his \sys{ProfInt} prototype for subformula linking
    in intuitionistic logic \cite{ProfInt}.}. As for the weakening rule
    {\rnmsf{w}}, it could be available as a contextual action when selecting
    blue items.
  \item[\textbf{\identity}]
    Although the {\rnmsf{i{\downarrow}}} rule only corresponds to the base case
    of DnD actions, it would be easy to integrate their full SFL semantics
    directly in \sys{BJ}. Indeed our SFL rules (\reffig{DISL}) are already
    expressed as rewriting rules, just like the graphical rules of \sys{BJ}
    (\reffig{graphical-BJ}). Thus it is just a matter of adding linkage creation
    rules like those of \refsec{dnd-completeness}, but between adjacent formulas
    in a solution (see \reffig{bubbles-linkage}).

    The cut rule was handled in Actema with a separate \textsf{+hyp} button,
    which adds the cut formula $A$ (input by the user in a dialog box) as a new
    hypothesis in the current goal, and as the conclusion in a new subgoal (see
    \refsec{newitems}). Since subgoals are now reified as bubbles, the
    {\rnmsf{i{\uparrow}}} rule could be mapped instead to a contextual action
    available on any red item $\conc{\Delta}$, which would have the effect of
    spawning a bubble around it with a blue item $\hypo{A}$, and another bubble
    nearby it with a red item $\conc{A}$.

    % Finally, an analog to the cut rule {\rnmsf{i{\uparrow}}} is the rule
    % {\rnmsf{d\uparrow}} for adding new definitions (\reffig{bubbles-vars}).
    % Their similarity is more striking in a logical framework like Martin-LÃ¶f
    % type theory, where mathematical objects and propositions are expressed in
    % the same language. In Actema it is handled with a separate \textsf{+expr}
    % button, and could here be mapped to a contextual action available anywhere
    % on the proof canvas\sidenote{In type theory, the body of type $T$ of the
    % definition could be left for completion as a new subgoal with conclusion
    % $T$, and thus be expressed as a new bubble that can be solved later.}.
  \item[\textbf{\heating}]
    For $\mathbb{H}$-rules that spawn bubbles like {\rnm{\land{+}}}, it is
    important that bubbles stay close to the item being clicked, in order to
    make the transformation clear visually. One could even imagine a small
    animation that smoothly turns the main connective into bubbles, to convey
    more effectively the intuition that heating rules break logical connectives
    seen as chemical bonds.

    % Regarding the rules involving quantifiers, two remarks are in order:
    % \begin{itemize}
    %   \item In Actema, rules {\rnm{\forall{+}}} and {\rnm{\exists{-}}} would
    %   introduce a new green variable in the context. To accomodate for this in a
    %   bubble-based GUI, one needs to extend the notion of solution so that
    %   it incorporates local variables, in addition to formulas:
    %   \begin{align*}
    %     \Gamma, \Delta &\Coloneq \iota_1, \ldots, \iota_n \\
    %     % \iota &\Coloneq A \mid \delta \\
    %     % \delta &\Coloneq x \mid \ldef{x}{t}
    %     \iota &\Coloneq A \mid \ldef{x}{\beta} \\
    %     \beta &\Coloneq \emptyset \mid t
    %   \end{align*}
    %   In this syntax, $\ldef{x}{t}$ represents a local definition with name $x$
    %   and body $t$, and $\ldef{x}{\emptyset}$ a local variable with name $x$.
    %   That is, variables are seen as definitions without a body. Then rules
    %   {\rnm{\forall{+}}} and {\rnm{\exists{-}}} are modified accordingly (see
    %   \reffig{bubbles-vars}).
    %   \item Instantiation rules {\rnm{\forall{-}}} and {\rnm{\exists{+}}} could
    %   be mapped as in Actema to DnD actions with a green item, corresponding to
    %   the alternative formulation of \reffig{bubbles-vars}. This way all the
    %   rules of \sys{BJ} become \emph{analytic}: if $S \step T$, then every
    %   subterm occurring in $T$ also occurs in $S$\sidenote{The only exceptions
    %   are the {\rnmsf{i{\downarrow}}} rule which will be shown to be admissible
    %   in \refsec{bubbles-completeness}, and the {\rnmsf{d{\uparrow}}} rule of
    %   \reffig{bubbles-vars}.}.
    % \end{itemize}
\end{description}

Beyond the recovered uniformity of the user interface in terms of the chemical
metaphor, \sys{BJ} exhibits some features that are interesting both at the
proof-theoretical and user-experience levels:
\begin{description}
  \item[\textbf{Factorization}] It implements a form of \emph{context-sharing}
    between subgoals: that is, one can perform transformations on shared
    hypotheses (forward reasoning) without going back to a proof state anterior
    to the splitting of said subgoals. This should simplify the navigation in
    the proof as it is being constructed, by avoiding the need to locate these
    splitting points. In fact often beginners (but also occasionally seasoned
    users) do not have the reflex to do this, precisely because the interface
    makes it difficult. This results in proofs with a lot of duplicated
    arguments, since splitting goals systematically duplicates the context of
    hypotheses. Thus bubbles can be seen as a mechanism that favors by default a
    style of proof with better factorization of subproofs.

  \item[\textbf{Navigation}] The tree structure of subgoals is immediately
    apparent in the proof state through the nesting of bubbles. Thus part of the
    information on the proof construction process, which was made implicit and
    temporal in the proof state history, is now made explicit and spatial in the
    proof state itself\sidenote{This concern of finding an explicit graphical
    representation of the ``motions of reasoning \emph{in actu}'', and not only
    the states of mind, can be found already in the works of Peirce on his
    existential graphs \cite{Roberts1973-inactu}. We will come back to this in
    \refch{eg}.}.
    
    There are multiple ways to visualize trees on a planar surface, but if we
    are to maintain the bubble metaphor, \emph{zoomable user interfaces} seem to
    be a right fit: they allow for efficient space management and navigation,
    and zooming in intuitively conveys the idea of focusing on a specific
    subgoal. One could also zoom out to have an overview of the different
    subgoals and their shared context, something which is hard to do in current
    proof assistants.
    
    When zoomed in on a subgoal, the shared contexts around it will not be
    visible anymore. While this is useful to focus attention and avoid being
    distracted by other subgoals, it can quickly become cumbersome for the user
    to always have to zoom out in order to retrieve hypotheses from these shared
    contexts. One solution would be to rebrand the context zone of Actema as a
    \emph{global} context zone, where all the shared contexts available in the
    subgoal under focus are merged in a single list, and immediately accessible
    for manipulation. Of course actions performed in the context zone would be
    reflected in the proof canvas, and vice versa.

  \item[\textbf{Goal diffing}] From a user perspective, the locality of rules
    means that applying some action to one or two items will not involve other
    items\sidenote{The only exceptions are clicks on blue $\bot$, $\lor$ and
    ${\limp}$, but the only extra item they involve is the conclusion.}.
    Non-local rules are less natural for a beginner because they modify a global
    state (here other items and subgoals) which is not clearly correlated to the
    transformed data, often because it is not immediately visible.

    For instance in Actema, many users have reported difficulties in
    understanding the effect of click actions that create new subgoals. A first
    reason that can easily be remedied, is that there was not enough visual
    feedback to indicate the newly created tabs. But a deeper limitation is that
    the user needs to explicitly focus on these subgoals to show their content,
    which they might not do immediately. And then it gets difficult to keep
    track of the origin of said subgoals without a way to visualize the tree
    structure of the proof.

    All these concerns can be addressed within the bubble metaphor: since
    bubbles are items freely positioned on the canvas, all the new items
    produced by an action can stay near the location where the action was
    initiated (i.e. the click or drop location); and since all transformations
    are local, all items not involved in the action can have their locations
    preserved. In other words, bubbles make it easier to understand the
    \emph{difference} between a goal and subgoals generated by a proof action,
    which is crucial when learning the semantics of actions through practice.
    % This is of limited importance however in our case, because sequent calculus
    % rules always perform the same trivial operation on the global state:
    % duplicating the whole context of hypotheses.
\end{description}
